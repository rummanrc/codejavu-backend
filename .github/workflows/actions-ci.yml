name: CI

on:
  push:
    branches:
      - dev1.0
  pull_request:
    branches:
      - dev1.0

jobs:
  build:
    name: Build and Test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run Test Script
        run: sh ./scripts/test.sh
        env:
          DOMAIN=localhost
          STACK_NAME=codejavu-com
          TRAEFIK_PUBLIC_NETWORK=traefik-public
          TRAEFIK_TAG=codejavu.com
          TRAEFIK_PUBLIC_TAG=traefik-public
          DOCKER_IMAGE_BACKEND=codejavu-backend
          DOCKER_IMAGE_CELERYWORKER=celeryworker
          BACKEND_CORS_ORIGINS=["http://localhost", "http://localhost:4200", "http://localhost:3000", "http://localhost:8080", "https://localhost", "https://localhost:4200", "https://localhost:3000", "https://localhost:8080", "http://dev.codejavu.com", "https://stag.codejavu.com", "https://codejavu.com", "http://local.dockertoolbox.tiangolo.com", "http://localhost.tiangolo.com"]
          PROJECT_NAME=codejavu
          SECRET_KEY=secret123
          FIRST_SUPERUSER=admin@codejavu.com
          FIRST_SUPERUSER_PASSWORD=password
          SMTP_TLS=True
          SMTP_PORT=587
          EMAILS_FROM_EMAIL=info@codejavu.com
          USERS_OPEN_REGISTRATION=False
          FLOWER_BASIC_AUTH=admin:password
          POSTGRES_SERVER=db
          POSTGRES_USER=postgres
          POSTGRES_PASSWORD=password
          POSTGRES_DB=app
